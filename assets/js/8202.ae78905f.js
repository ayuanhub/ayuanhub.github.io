"use strict";(self.webpackChunkcvmdoc=self.webpackChunkcvmdoc||[]).push([[8202],{999:(e,t,a)=>{a.d(t,{a:()=>i,b:()=>n});var s=a(1846),r=a(9564),i=class extends Error{static{(0,r.a)(this,"OramaClientNotInitializedError")}constructor(){super("Orama Client is not initialized")}},n=class{static{(0,r.a)(this,"ChatService")}constructor(e){this.sendQuestion=e=>{if(!this.oramaClient)throw new i;return this.answerSession||(this.answerSession=this.oramaClient.createAnswerSession({events:{onStateChange:(0,r.a)((e=>{let t=e.filter((e=>!!e.query));s.b.interactions=t.map(((t,a)=>{var r;let i=s.a.loading;t.aborted?i=s.a.aborted:t.loading&&t.sources?i=s.a.rendering:t.loading&&t.response?i=s.a.streaming:!t.loading&&t.response&&(i=s.a.done);let n=null===(r=t.sources)||void 0===r?void 0:r.map((e=>e.document));return{query:t.query,interactionId:t.interactionId,response:t.response,relatedQueries:t.relatedQueries,status:i,latest:e.length-1===a,sources:n}}))}),"onStateChange")}})),this.answerSession.ask({term:e,related:{howMany:3,format:"question"}}).catch((e=>{s.b.interactions=s.b.interactions.map(((e,t)=>t===s.b.interactions.length-1?Object.assign(Object.assign({},e),{status:s.a.error}):e)),console.error(e)}))},this.abortAnswer=()=>{if(!this.answerSession)throw new i;this.answerSession.abortAnswer()},this.regenerateLatest=async()=>{if(!this.answerSession)throw new i;this.answerSession.regenerateLast({stream:!1})},this.resetChat=async()=>{if(!this.answerSession)throw new i;s.b.interactions.length<1||(["loading","rendering","streaming"].includes(s.b.interactions[s.b.interactions.length-1].status)&&this.answerSession.abortAnswer(),this.answerSession.clearSession())},this.oramaClient=e}}},3541:(e,t,a)=>{a.d(t,{a:()=>r});var s=(0,a(517).a)({count:0,facets:[],facetProperty:"",results:[],resultMap:{},highlightedIndex:-1,loading:!1,error:!1,searchService:null,searchParams:null}),{state:r}=s;!function(e,t){var a={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(a[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(s=Object.getOwnPropertySymbols(e);r<s.length;r++)t.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(e,s[r])&&(a[s[r]]=e[s[r]])}}(s,["state"])},7347:(e,t,a)=>{a.d(t,{a:()=>r,b:()=>i});var s=(0,a(517).a)({open:!1,currentTask:"search",currentTerm:""}),{state:r}=s,i=function(e,t){var a={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(a[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(s=Object.getOwnPropertySymbols(e);r<s.length;r++)t.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(e,s[r])&&(a[s[r]]=e[s[r]])}return a}(s,["state"])},8202:(e,t,a)=>{a.r(t),a.d(t,{orama_search_box:()=>m});var s=a(999),r=a(7480),i=a(3541),n=a(7347),o=a(1846),h=(a(517),a(6653)),c=a(9564),l=class{static{(0,c.a)(this,"SearchService")}constructor(e){this.search=(e,t)=>{var a;if(!this.oramaClient)throw new s.a;if(this.abortSearch(),!e)return i.a.results=[],i.a.count=0,i.a.facets=[],void(i.a.highlightedIndex=-1);i.a.loading=!0;let r=this.abortController,n=null!==(a=i.a.searchParams)&&void 0!==a?a:{},{limit:o,offset:h,where:c}=n,l=function(e,t){var a={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(a[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(s=Object.getOwnPropertySymbols(e);r<s.length;r++)t.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(e,s[r])&&(a[s[r]]=e[s[r]])}return a}(n,["limit","offset","where"]);this.oramaClient.search(Object.assign(Object.assign(Object.assign(Object.assign({},l),{term:e,limit:o||10}),c?{where:c}:{}),i.a.facetProperty&&Object.assign({facets:{[i.a.facetProperty]:{}}},t&&"All"!==t&&{where:Object.assign({[i.a.facetProperty]:{eq:t}},c)})),{abortController:this.abortController}).then((e=>{r.signal.aborted||(i.a.results=this.parserResults(e?.hits,i.a.resultMap),i.a.count=e?.count||0,i.a.facets=this.parseFacets(e?.facets,i.a.facetProperty),i.a.highlightedIndex=-1,i.a.loading=!1)})).catch((()=>{i.a.loading=!1}))},this.retry=()=>{throw new Error("Not implemented")},this.parserResults=(e,t)=>{if(!e)return[];let a=[],s={};for(let r of e){let e=this.hitToSearchResultParser(r,t),i=r.document[t.section];if(void 0===s[i])a.push({section:i,items:[e]}),s[i]=a.length-1;else{a[s[i]].items.push(e)}}return a},this.hitToSearchResultParser=(e,t)=>({id:e.id,score:e.score,title:t.title?e.document[t.title]:e.document.title,description:t.description?e.document[t.description]:e.document.description,path:t.path?e.document[t.path]:e.document.path}),this.parseFacets=(e,t)=>{var a;if(!t||!e||null===(a=e[t])||void 0===a||!a.values)return[];let s=e[t],r=Object.values(s.values).reduce(((e,t)=>e+t),0),i=Object.keys(s.values).map((e=>({name:e,count:s.values[e]})));return i.unshift({name:"All",count:r}),i},this.oramaClient=e,this.abortController=new AbortController}abortSearch(){this.abortController.abort(),this.abortController=new AbortController}},d=new class extends EventTarget{static{(0,c.a)(this,"WindowService")}constructor(){super(),this._width=window.innerWidth,this.handleResize=this.handleResize.bind(this),window.addEventListener("resize",this.handleResize)}handleResize(){this._width=window.innerWidth,this.dispatchEvent(new CustomEvent("widthChange",{detail:this._width}))}get width(){return this._width}},m=class{static{(0,c.a)(this,"SearchBox")}constructor(e){(0,h.a)(this,e),this.searchboxClosed=(0,h.e)(this,"searchboxClosed",7),this.closeSearchbox=()=>{n.a.open=!1,this.open=!1},this.onPrefersColorSchemeChange=e=>{this.systemScheme=e.matches?"dark":"light",this.updateTheme()},this.updateWindowWidth=e=>{this.windowWidth=e.detail},this.themeConfig=void 0,this.colorScheme="light",this.index=void 0,this.clientInstance=void 0,this.open=!1,this.facetProperty=void 0,this.resultMap={},this.sourceBaseUrl=void 0,this.sourcesMap=void 0,this.disableChat=!1,this.layout="modal",this.placeholder=void 0,this.chatPlaceholder=void 0,this.searchPlaceholder=void 0,this.suggestions=void 0,this.searchParams=void 0,this.oramaClient=void 0,this.componentID=(0,r.e)("search-box"),this.systemScheme="light",this.windowWidth=void 0}indexChanged(){this.startServices()}watchHandler(){this.updateTheme()}handleOpenPropChange(e){n.a.open=e}handleFacetPropertyChange(e){i.a.facetProperty=e}handleSearchParamsChange(e){i.a.searchParams=e}handleItemClick(e){console.log("Item clicked",e.detail)}handleCloseOnEsc(e){"Escape"===e.key&&this.closeSearchbox()}modalStatusChangedHandler(e){e.detail.id===this.modalRef&&(e.detail.open||(n.a.open=!1,this.open=!1))}updateTheme(){let e="system"===this.colorScheme?this.systemScheme:this.colorScheme,t=this.htmlElement;t&&e&&(t.classList.remove("theme-light","theme-dark"),t.classList.add(`theme-${e}`)),this.updateCssVariables(e)}updateCssVariables(e){var t;let a=this.themeConfig,s=this.htmlElement;if(s&&a&&e){if(null!==(t=a.colors)&&void 0!==t&&t[e])for(let t of Object.keys(a.colors[e]))s.style.setProperty(`${t}`,a.colors[e][t]);if(a.typography)for(let e of Object.keys(a.typography))s.style.setProperty(`${e}`,a.typography[e])}}startServices(){(0,r.c)(this.htmlElement,this.index,this.clientInstance),this.oramaClient=this.clientInstance?this.clientInstance:(0,r.d)(this.index),i.a.searchService=new l(this.oramaClient),o.b.chatService=new s.b(this.oramaClient)}componentWillLoad(){i.a.facetProperty=this.facetProperty,i.a.resultMap=this.resultMap,i.a.searchParams=this.searchParams,this.htmlElement.id=this.componentID,this.startServices()}connectedCallback(){this.windowWidth=d.width,n.a.open=this.open,n.b.onChange("open",(()=>{this.open=n.a.open})),this.htmlElement.id=this.componentID,this.schemaQuery=window.matchMedia("(prefers-color-scheme: dark)"),this.systemScheme=this.schemaQuery.matches?"dark":"light",this.updateTheme(),this.schemaQuery.addEventListener("change",this.onPrefersColorSchemeChange),d.addEventListener("widthChange",this.updateWindowWidth)}disconnectedCallback(){var e;d.removeEventListener("widthChange",this.updateWindowWidth),null===(e=this.schemaQuery)||void 0===e||e.removeEventListener("change",this.onPrefersColorSchemeChange)}getSearchBox(){return(0,h.b)(h.i,null,(0,h.b)("orama-search",{class:""+(this.windowWidth>1024||"search"===n.a.currentTask?"section-active":"section-inactive"),placeholder:(null==this?void 0:this.searchPlaceholder)||"Search...",focusInput:"search"===n.a.currentTask,sourceBaseUrl:this.sourceBaseUrl,disableChat:this.disableChat,suggestions:this.suggestions}))}getChatBox(){return(0,h.b)(h.i,null,(0,h.b)("orama-chat",{class:""+("chat"===n.a.currentTask?"section-active":"section-inactive"),defaultTerm:"chat"===n.a.currentTask?n.a.currentTerm:"",showClearChat:!1,focusInput:"chat"===n.a.currentTask||0===o.b.interactions.length,placeholder:(null==this?void 0:this.chatPlaceholder)||this.placeholder,sourceBaseUrl:this.sourceBaseUrl,sourcesMap:this.sourcesMap,suggestions:this.suggestions}))}getSlidingPanel(e={withBackdrop:!1}){return(0,h.b)(h.i,null,this.windowWidth>1024&&(0,h.b)("orama-sliding-panel",{open:"chat"===n.a.currentTask,backdrop:e.withBackdrop,closed:(0,c.a)((()=>{n.a.currentTask="search"}),"closed")},this.getChatBox()))}getInnerContent(){return(0,h.b)(h.i,null,this.disableChat?null:(0,h.b)("orama-navigation-bar",{handleClose:this.closeSearchbox,showChatActions:"chat"===n.a.currentTask}),(0,h.b)("div",{class:"main"},this.getSearchBox(),this.windowWidth<=1024&&this.getChatBox()),(0,h.b)("orama-footer",{colorScheme:"system"===this.colorScheme?this.systemScheme:this.colorScheme}))}getModalLayout(){return(0,h.b)(h.i,null,(0,h.b)("orama-modal",{ref:(0,c.a)((e=>this.modalRef=e),"ref"),open:n.a.open,class:"modal",mainTitle:"Start your search",closeOnEscape:"search"===n.a.currentTask||this.windowWidth<=1024},this.getInnerContent()),this.getSlidingPanel())}getEmbedLayout(){return(0,h.b)(h.i,null,(0,h.b)("div",{class:"embed"},this.getInnerContent()),this.getSlidingPanel({withBackdrop:!0}))}render(){return i.a.searchService?o.b.chatService?"embed"===this.layout?this.getEmbedLayout():this.getModalLayout():(0,h.b)("orama-text",{as:"p"},"Unable to initialize chat service"):(0,h.b)("orama-text",{as:"p"},"Unable to initialize search service")}get htmlElement(){return(0,h.d)(this)}static get watchers(){return{index:["indexChanged"],themeConfig:["watchHandler"],colorScheme:["watchHandler"],open:["handleOpenPropChange"],facetProperty:["handleFacetPropertyChange"],searchParams:["handleSearchParamsChange"]}}};m.style="@keyframes showIn{0%{opacity:0;transform:translateY(-25%)}to{opacity:1;transform:translateY(0)}}@media (min-width:1024.02px){.modal orama-input{border-radius:0;margin:0;padding:0}.modal input[type=search]{border-radius:.75rem .75rem 0 0;border-radius:var(--radius-m,calc(12rem/var(--orama-base-font-size, 16))) var(--radius-m,calc(12rem/var(--orama-base-font-size, 16))) 0 0}}.embed{background-color:#fff;background-color:var(--background-color-secondary,#fff);border:1px solid #dadada;border:1px solid var(--border-color-primary,#dadada);border-radius:.75rem;border-radius:var(--radius-m,calc(12rem/var(--orama-base-font-size, 16)));display:flex;flex-direction:column;height:100%;inset:0;margin:0 auto;max-height:25rem;max-height:calc(400rem/var(--orama-base-font-size, 16));overflow:hidden;padding:0;width:100%}@media (min-width:1024.02px){.embed orama-input{border-radius:0;margin:0;padding:0}.embed input[type=search]{border-radius:.75rem .75rem 0 0;border-radius:var(--radius-m,calc(12rem/var(--orama-base-font-size, 16))) var(--radius-m,calc(12rem/var(--orama-base-font-size, 16))) 0 0}}.main{flex-direction:column;flex-grow:1;overflow:hidden}.main,.section-active{display:flex}.section-inactive{display:none}"}}]);